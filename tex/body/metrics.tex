\section{Tags and Tag-Matching Metrics}

\input{fig/uniformification.tex}

In all experiments, we used 32-bit bitstrings as tags.
Formally, we define a tag $t$ as a fixed-length binary vector,
\begin{align*}
t = \langle t_0, t_1, t_2, \dots, t_{n-2}, t_{n-1} \rangle
\end{align*}
where
\begin{align*}
\forall i, t_i \in \{0, 1\} \text{ and } n=32.
\end{align*}

In experiments where mutations were applied to tags, individual bits were toggled stochastically at a uniform per-bit rate.

We call an algorithm used to calculate the match quality between two tags a tag-matching metric.
A tag-matching metric takes two tags as operands and calculates a match distance between them.
Low match distance indicates a ``good'' or ``strong'' match.
High match distance indicates a ``poor'' or ``weak'' match.
For consistency between metrics, we bound all match distances so that a distance of 0 is the ``best'' possible match and a distance of 1 is the ``worst'' possible match.

We compared five tag-matching metrics: hamming, hash, integer, bidirectional integer, and streak.
The hamming and bidirectional integer metrics are included because of their ubiquity in artificial life systems.
The integer metric is included due to its use in seminal work exploring tag-matching in genetic programs \citep{spector2011tag, spector2011s,spector2012tag}.
The streak metric was proposed to model large-effect mutations observed in biology but, to our knowledge, has not yet been formally studied in an evolving system.
The hash metric is introduced in this work in order to investigate the implications of a completely geometrically-unstructured tag-matching scheme.
Table \ref{tab:metrics} compares summary descriptions for each metric.

% Full mathematical definitions and implementation details appear in \href{doi.org/10.17605/OSF.IO/GW5MC}{supplementary material} \citep{Moreno_Ofria_2020}.

\input{tab/metrics.tex}

Sections \ref{sec:hamming}, \ref{sec:hash}, \ref{sec:integer}, \ref{sec:bidirectionalinteger}, and \ref{sec:streak} provide formal definitions for each metric.

\input{tex/body/metrics/hamming.tex}
\input{tex/body/metrics/hash.tex}
\input{tex/body/metrics/integer.tex}
\input{tex/body/metrics/bidirectionalinteger.tex}
\input{tex/body/metrics/streak.tex}

\subsection{Match Distance Normalization}
\label{sec:uniformification}

For consistency of implementation and interpretation, all metrics output tag-matching distances between 0.0 (a ``perfect'' match) and 1.0 (a ``worst'' match).

However, the distribution of tag-match distances within this range may vary substantially between metrics.
For example, the probability of a match distance $<1/32$ is $1/32$ under the hash metric but $1/2^{32}$ under the hamming metric.

In order to ensure an intuitive interpretation of match distances that was consistent across all tag-matching metrics, we normalized metrics' match distances so that the distances between pairs of randomly generated tags would follow a uniform distribution between 0.0 and 1.0.
In this discussion, we refer to match distance before normalization as ``raw.''

For example, two tags with a 0.01 normalized match distance would be better-matched than 99\% of randomly-generated tag pairs.
Additionally, in situations where raw match distance plays a mechanistic role (for example, probabilistic matching or threshold-based cutoffs), this transformation ensures consistency across metrics.

We performed this normalization independently for each tag-matching metric using the following Monte Carlo approximation method.
\begin{enumerate}
\item We sampled 10,000 pairs of randomly-generated tags.
\item We calculated raw match distance between each pair of generated tags using the chosen tag-matching metric.
\item We organized these 10,000 sampled raw match distances into a list in ascending order.
\item To ensure coverage of the entire $[0.0,1.0]$ interval of valid tag match scores, we bookended the sorted list of raw match distances with 0.0 and 1.0.
\item We associated each list entry with its percentile ranking within the list.
\begin{enumerate}
    \item i.e., the best-matching 0.0 match distance was associated with the percentile ranking 0.0,
    \item the median match distance was associated with the percentile ranking 0.5, and
    \item the worst-matching 1.0 match distance was associated with the percentile ranking 1.0.
\end{enumerate}
\item For subsequent tag match distance calculations during the experiment, we performed a lookup on this list.
\begin{itemize}
    \item If a single exactly-identical raw match distance existed in the list, we returned its percentile ranking as the normalized match distance.
    \item If two or more exactly-identical raw match distances existed in the list, we returned the mean percentile ranking of these entries as the normalized match distance.
    \item If no exactly-identical raw match distance existed in the list, we linearly interpolated between the next-largest and next-smallest list entries' percentile rankings.
\end{itemize}
\end{enumerate}
Figure \ref{fig:uniformification} compares the distribution of match distances between randomly-sampled tags before and after this normalization process across tag-matching metrics.

All work reported here employed match distance normalization.
